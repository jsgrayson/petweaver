{% extends "base.html" %}

{% block title %}Pet Hunting - PetWeaver{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="hero-header">
            <h1 class="hero-title">üéØ Pet Hunting Guide</h1>
            <p class="hero-subtitle">
                <i class="fas fa-crosshairs me-2"></i>Prioritized list of pets to capture for your strategies
            </p>
            <div class="animated-border"></div>
        </div>
    </div>
</div>

<!-- Missing Pets List -->
<div class="row">
    <div class="col-md-12">
        <div id="missing-pets">
            <div class="text-center py-5">
                <i class="fas fa-spinner fa-spin fa-2x text-muted mb-3"></i>
                <p class="text-muted">Analyzing collection and strategies...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function loadMissingPets() {
        fetch('/api/hunting/missing')
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('missing-pets');

                if (data.length === 0 || (data.error && data.error.includes("empty"))) {
                    // Fetch some stats to show
                    Promise.all([
                        fetch('/api/status').then(r => r.json()),
                        fetch('/api/collection/all').then(r => r.json())
                    ]).then(([status, collection]) => {
                        container.innerHTML = `
                            <div class="card glass-card border-success">
                                <div class="card-body text-center py-5">
                                    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                                    <h2 class="text-success">Collection Complete!</h2>
                                    <p class="text-white mb-4">You have all the key pets for your loaded strategies.</p>
                                    <div class="row text-center mb-4">
                                        <div class="col-md-4">
                                            <div class="stat-card">
                                                <div class="stat-value">${status.stats.pets || collection.length}</div>
                                                <div class="stat-label">Pets Owned</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="stat-card">
                                                <div class="stat-value">${status.stats.strategies || 0}</div>
                                                <div class="stat-label">Strategies</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="stat-card">
                                                <div class="stat-value" style="color: #00ff88;">100%</div>
                                                <div class="stat-label">Coverage</div>
                                            </div>
                                        </div>
                                    </div>
                                    <small class="text-muted">Tip: Import more strategies to discover new pets to collect</small>
                                </div>
                            </div>
                        `;
                    }).catch(() => {
                        container.innerHTML = `
                            <div class="card glass-card border-success">
                                <div class="card-body text-center py-5">
                                    <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                                    <h2 class="text-success">All Clear!</h2>
                                    <p class="text-white">No missing pets for your current strategies.</p>
                                </div>
                            </div>
                        `;
                    });
                    return;
                }

                container.innerHTML = data.map((pet, index) => `
                    <div class="card mb-3 border-secondary">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-primary me-3">#${index + 1}</span>
                                        <h4 class="mb-0 text-white">${pet.name}</h4>
                                        <span class="badge bg-danger bg-opacity-25 text-danger ms-3">
                                            Needed for ${pet.needed_for.length} encounter(s)
                                        </span>
                                    </div>
                                    
                                    <div class="p-3 rounded bg-black border border-secondary mb-3">
                                        <div class="row g-2 text-sm">
                                            <div class="col-md-4">
                                                <strong class="text-muted">üìç Zone:</strong>
                                                <span class="text-info">${pet.zone || 'Unknown'}</span>
                                            </div>
                                            <div class="col-md-4">
                                                <strong class="text-muted">üéÅ Source:</strong>
                                                <span class="text-info">${pet.source || 'Unknown'}</span>
                                            </div>
                                            <div class="col-md-4">
                                                <strong class="text-muted">üó∫Ô∏è Coords:</strong>
                                                <span class="text-info">${pet.coords || 'N/A'}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <small class="text-muted d-block mb-1">Used in strategies:</small>
                                        <div class="d-flex flex-wrap gap-2">
                                            ${pet.needed_for.slice(0, 5).map(enc =>
                    `<span class="badge bg-secondary text-light">${enc}</span>`
                ).join('')}
                                            ${pet.needed_for.length > 5 ?
                        `<span class="badge bg-dark text-muted">+${pet.needed_for.length - 5} more</span>`
                        : ''}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end mt-3 mt-md-0">
                                    <a href="${pet.warcraftpets_url || 'https://www.google.com/search?q=' + encodeURIComponent(pet.name + ' warcraftpets')}" 
                                       target="_blank" 
                                       class="btn btn-outline-info">
                                        <i class="fas fa-external-link-alt me-2"></i>More Info
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            });
    }

    // Load on page load
    loadMissingPets();
</script>
{% endblock %}