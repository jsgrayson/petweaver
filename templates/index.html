{% extends "base.html" %}

{% block title %}PetWeaver - The Loom{% endblock %}

{% block content %}
<div class="container weaver-dashboard">
    <div class="text-center mb-5">
        <h1>PetWeaver</h1>
        <p class="lead" style="font-family: 'Cinzel', serif; color: #b0bec5; font-size: 1.2rem;">Weave your destiny.
            Conquer the battles.</p>
    </div>

    <!-- Stats / Status Row -->
    <div class="row mb-4 text-center">
        <div class="col-md-4">
            <h3 id="stat-pets">0</h3>
            <small>Pets Collected</small>
        </div>
        <div class="col-md-4">
            <h3 id="stat-strategies">0</h3>
            <small>Strategies Known</small>
        </div>
        <div class="col-md-4">
            <h3 id="stat-ready" style="color: var(--magic-blue)">0</h3>
            <small>Ready to Battle</small>
        </div>
    </div>

    <!-- Active Team Layout (The Loom) -->
    <div class="row justify-content-center">
        <!-- Pet Slot 1 -->
        <div class="col-md-4 mb-4">
            <div class="pet-card">
                <div class="pet-portrait">
                    <!-- Placeholder or Dynamic Image -->
                    <img src="https://wow.zamimg.com/images/wow/icons/large/inv_misc_head_dragon_01.jpg" alt="Pet Name"
                        class="img-fluid" style="width:100%; height:100%; object-fit: cover;">
                </div>
                <h3>Active Slot 1</h3>
                <div class="stats-gems mt-auto mb-2">
                    <span class="badge bg-success">HP</span>
                    <span class="badge bg-primary">PWR</span>
                    <span class="badge bg-danger">SPD</span>
                </div>
            </div>
        </div>

        <!-- Pet Slot 2 -->
        <div class="col-md-4 mb-4">
            <div class="pet-card">
                <div class="pet-portrait">
                    <img src="https://wow.zamimg.com/images/wow/icons/large/inv_misc_head_dragon_01.jpg" alt="Pet Name"
                        class="img-fluid" style="width:100%; height:100%; object-fit: cover;">
                </div>
                <h3>Active Slot 2</h3>
                <div class="stats-gems mt-auto mb-2">
                    <span class="badge bg-success">HP</span>
                    <span class="badge bg-primary">PWR</span>
                    <span class="badge bg-danger">SPD</span>
                </div>
            </div>
        </div>

        <!-- Pet Slot 3 -->
        <div class="col-md-4 mb-4">
            <div class="pet-card">
                <div class="pet-portrait">
                    <img src="https://wow.zamimg.com/images/wow/icons/large/inv_misc_head_dragon_01.jpg" alt="Pet Name"
                        class="img-fluid" style="width:100%; height:100%; object-fit: cover;">
                </div>
                <h3>Active Slot 3</h3>
                <div class="stats-gems mt-auto mb-2">
                    <span class="badge bg-success">HP</span>
                    <span class="badge bg-primary">PWR</span>
                    <span class="badge bg-danger">SPD</span>
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-5 mb-4">
        <button class="btn-weave" onclick="runAutomation()">
            Weave Team
        </button>
        <div id="status-msg" class="mt-3 text-muted">Ready to weave...</div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function updateStatus() {
        fetch('/api/status')
            .then(r => r.json())
            .then(data => {
                document.getElementById('stat-pets').innerText = data.stats.pets;
                document.getElementById('stat-strategies').innerText = data.stats.strategies;
                document.getElementById('stat-ready').innerText = data.stats.ready;

                const btn = document.querySelector('.btn-weave');
                const msg = document.getElementById('status-msg');

                if (data.status === 'RUNNING') {
                    btn.style.opacity = '0.5';
                    btn.innerText = 'WEAVING...';
                    msg.innerText = 'The Loom is active...';
                } else {
                    btn.style.opacity = '1';
                    btn.innerText = 'WEAVE TEAM';
                    msg.innerText = 'Ready to weave.';
                }
            });
    }

    function runAutomation() {
        fetch('/api/run', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ skip_fetch: true })
        });
        document.getElementById('status-msg').innerText = 'Initializing weave...';
    }

    setInterval(updateStatus, 1000);
    updateStatus();
</script>
{% endblock %}